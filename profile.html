<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="./images/eduPro_logo.jpg">
  <title>My Profile</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
  <link rel="stylesheet" href="css/profile.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- nav icons in smaller screen -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- font family -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Poppins:wght@200;300;400;600;700&display=swap" rel="stylesheet">
   <!-- Embedding JavaScript -->
  <script>
      document.addEventListener("DOMContentLoaded", function() {

        // Retrieve the stored name and email from local storage
        const storedName = localStorage.getItem("user_name");
        const storedEmail = localStorage.getItem("user_email");

        // Populate the name and email fields in the form
        document.getElementById("name").value = storedName;
        document.getElementById("email").value = storedEmail;

        populateFormData();

          // Get the current page URL
          var currentPageURL = window.location.href;
          
          // Get all navigation links
          var navLinks = document.querySelectorAll('.nav-links ul li a');
  
          // Loop through each link
          navLinks.forEach(function(link) {
              // Check if the link's href matches the current page URL
              if (link.href === currentPageURL) {
                  // Add the 'active' class to the matching link
                  link.classList.add('active');
              }
          });
      });

      // Prevent default action when clicking profile icon
      document.addEventListener("DOMContentLoaded", function() {
          document.getElementById("profileIcon").addEventListener("click", function(event) {
              event.preventDefault(); // Prevent the default action of the click event
          });
      });
  </script>
</head>
<body>
  <header>
    <nav>
      <a href="index.html"><img src="./images/eduPro_logo.jpg" alt="logo"></a>
      <div class="nav-links" id="navLinks">
          <!-- close icon -->
          <i class="fas fa-times" onclick="hideMenu()"></i>
          <ul>
              <li><a href="subscription.html">Subscription</a></li>
              <li><a href="discover_tutor.html">Discover Tutor</a></li>
              <li><a href="tuitionFee.html">Payment</a></li>
              <li><a href="helpdesk.html">Helpdesk</a></li>         
          </ul>  <!--closing unorder list -->
      </div> <!--closing nav-links -->
      <!-- nav icon -->
      <div class="navIcon">
          <a href="cart.html" class="navLink"><img src="./images/addToCart_logo.png" alt="add to cart"></a>
          <div class="dropdown">
            <a href=" " class="navLink" id="profileIcon"><img id="profileIconImg" src="./images/ic_profile.png" alt="user profile"></a>
            <div class="dropdown-content" id="profileDropdownContent">
              <!-- Dropdown content here -->
              <a id="profile" href="profile.html">My Profile</a>
              <div class="logout">
                <a href="index-bfr-login.html" onclick="logout()"><img id="logout-ic" src="Images\logout.png">Log Out</a>
              </div>
            </div>
          </div>
      </div>  <!--closing nav icon -->
      <i class="fas fa-bars" onclick="showMenu()"></i>
    </nav>
  </header>
  <div class="container">
    <h1>My Profile</h1>
    <div class="parent">
      <div class="profile-info">
        <div class="alignment">
          <h2>General Details</h2>
          <form method="post">
            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" id="name" name="name" placeholder="Name" autocomplete="on" required>
            </div>
            <div class="form-group">
              <label for="username">Username</label>
              <input type="text" id="username" name="username" placeholder="Username" autocomplete="on" required>
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" placeholder="Email address" autocomplete="on" required>
            </div>
            <div class="form-group">
              <label for="phone">Phone No</label>
              <input type="tel" id="phone" name="phone" pattern="01[0-9]{1}-[0-9]{7,9}" title="01x-xxxxxxx" placeholder="Phone no" >
            </div>
            <div class="form-group">
              <label for="gender">Gender</label>
              <select class="dropdown" name="gender" id="gender">
                <option value="" disabled selected >Choose your gender</option>
                <option id="male" value="Male">Male</option>
                <option id="female" value="Female">Female</option>
              </select>
            </div>
            <div class="form-group">
              <label for="dob">Date of Birth</label>
              <input type="date" id="dob" name="dob"> 
            </div>
            <input class="button" type="submit" value="Save Changes">
          </form>
        </div>
        <div class="alignment">
          <div class="edit-profile-pic">
            <img id="profile-pic" src="Images\profile-pic.png" alt="Profile Picture" width="150">
            <input type="file" id="profilePictureInput" accept="image/*" onchange="previewProfilePicture(event)" style="display: none;">
            <label for="profilePictureInput">
              <img id="edit-pic" src="Images\edit-pic.png" alt="Upload" width="35">
            </label>
          </div>
          <div class="change-pswd">
            <h2>Change password</h2>
            <form id="change-password-form" method="post">
              <div class="form-group">
                  <label for="old_pswd">Current password</label>
                  <div class="pswd-group">
                    <input type="password" id="old_pswd" name="old_pswd" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_])(?=.*\S).{8,}" title="Password must contain at least one lowercase letter, one uppercase letter, one special character, and be at least 8 characters long." placeholder="Password" autocomplete="current-password" required>
                    <i class="far fa-eye-slash" id="toggleOldPassword"></i>
                  </div>
                </div>
                <div class="form-group">
                  <label for="new_pswd">New password</label>
                  <div class="pswd-group">
                    <input type="password" id="new_pswd" name="new_pswd" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_])(?=.*\S).{8,}" title="Password must contain at least one lowercase letter, one uppercase letter, one special character, and be at least 8 characters long." placeholder="Password" required>
                    <i class="far fa-eye-slash" id="toggleNewPassword"></i>
                  </div>
                </div>
                <div class="form-group">
                  <label for="confirm-pswd">Confirm password</label>
                  <div class="pswd-group">
                    <input type="password" id="confirm-pswd" name="confirm-pswd" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_])(?=.*\S).{8,}" title="Password must contain at least one lowercase letter, one uppercase letter, one special character, and be at least 8 characters long." placeholder="Confirm new password" required>
                    <i class="far fa-eye-slash" id="toggleConfirmPassword"></i>
                  </div>
                </div>
                <input class="button" type="submit" value="Change Password">
            </form>
          </div>
        </div>

      </div>
    </div>
  </div>
  <footer>
    <section class="footer">
      <div class="container6">
        <div class="frame">
          <div class="link">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="subscription.html">Subscription</a></li>
              <li><a href="discover_tutor.html">Courses</a></li>
              <li><a href="helpdesk.html">FAQ</a></li>
            </ul>  
          </div>
          <img id="logo" src="Images\logo.png" alt="EduPro" width="200">
          <div class="link">
            <h4>Contact Us</h4>
            <ul>
              <li>
                <img src="Images\email.png" alt="Email">
                <a href="mailto:info@edupro.com?subject=Inquiry%20about%20EduPro">info@edupro.com</a>
              </li>
              <li>
                <img src="Images\phone.png" alt="Phone no">
                <a href="https://wa.me/60173968518">+60 17 396 8518</a>
              </li>
              <li>
                <img src="Images\location.png" alt="Location">
                <a href="https://www.google.com/maps?q=4+Persiaran+Stonor,+Kuala+Lumpur,+50450+Kuala+Lumpur,+Wilayah+Persekutuan+Kuala+Lumpur">4, Persiaran Stonor, 50450 Kuala Lumpur, Wilayah Persekutuan Kuala Lumpur, Malaysia</a>
              </li>
            </ul> 
          </div>
        </div>
        <hr> 
        <p>&copy; 2024 EduPro. All rights reserved.</p>
      </div>
    </section>
  </footer>
  <script>
    // JavaScript for Toggle Menu
    var navLinks = document.getElementById("navLinks");

    function showMenu() {
        navLinks.style.right = "0";
    }

    function hideMenu() {
        navLinks.style.right = "-200px";
    }

    //Toggle password visibility
    document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('old_pswd');
        const togglePasswordButton = document.getElementById('toggleOldPassword');

        togglePasswordButton.addEventListener('click', function() {
          const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
          passwordInput.setAttribute('type', type);
          // Toggle eye icon based on password visibility
          togglePasswordButton.classList.toggle('fa-eye-slash');
          togglePasswordButton.classList.toggle('fa-eye');
        });
      });

      //Toggle password visibility
      document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('new_pswd');
        const togglePasswordButton = document.getElementById('toggleNewPassword');

        togglePasswordButton.addEventListener('click', function() {
          const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
          passwordInput.setAttribute('type', type);
          // Toggle eye icon based on password visibility
          togglePasswordButton.classList.toggle('fa-eye-slash');
          togglePasswordButton.classList.toggle('fa-eye');
        });
      });

      //Toggle password visibility
      document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('confirm-pswd');
        const togglePasswordButton = document.getElementById('toggleConfirmPassword');

        togglePasswordButton.addEventListener('click', function() {
          const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
          passwordInput.setAttribute('type', type);
          // Toggle eye icon based on password visibility
          togglePasswordButton.classList.toggle('fa-eye-slash');
          togglePasswordButton.classList.toggle('fa-eye');
        });
      });

      // JavaScript for toggling password visibility
    const togglePassword = document.querySelectorAll('.toggle-password');
    togglePassword.forEach(button => {
      button.addEventListener('click', function() {
        const input = this.parentNode.querySelector('input');
        input.type = input.type === 'password' ? 'text' : 'password';
        this.classList.toggle('fa-eye-slash');
        this.classList.toggle('fa-eye');
      });
    });

      // JavaScript for handling form submission
    document.getElementById('change-password-form').addEventListener('submit', function(event) {
      event.preventDefault();

      // Get input values
      const oldPassword = document.getElementById('old_pswd').value;
      const newPassword = document.getElementById('new_pswd').value;
      const confirmPassword = document.getElementById('confirm-pswd').value;

      // Validate passwords
      if (newPassword !== confirmPassword) {
        alert('Password do not match');
        return;
      }

      // If all validation passes, show success message
      alert('Password changed successfully');

      // Clear input fields
      document.getElementById('old_pswd').value = '';
      document.getElementById('new_pswd').value = '';
      document.getElementById('confirm-pswd').value = '';
    });

      //Edit general information
      document.addEventListener("DOMContentLoaded", function() {
      const saveButton = document.querySelector("input.button[type='submit']");

      saveButton.addEventListener("click", function(event) {
          event.preventDefault(); // Prevent the default form submission

          // Optionally, you can display a confirmation message
          alert("Changes saved successfully!");

          // Highlight filled input fields
        highlightFilledFields();
        });
      });

      // Handling profile picture upload
      document.addEventListener('DOMContentLoaded', function() {
          const profilePictureInput = document.getElementById('profilePictureInput');
          const profilePic = document.getElementById('profile-pic');
          const profileIconImg = document.getElementById('profileIconImg');

          // Check if there's already an uploaded profile picture stored in localStorage
          const uploadedPicture = localStorage.getItem('uploadedProfilePicture');
          console.log("Uploaded picture from localStorage:", uploadedPicture);
          if (uploadedPicture) {
              profilePic.src = uploadedPicture;
              profileIconImg.src = uploadedPicture; // Update profile icon directly with uploaded picture
          }

          profilePictureInput.addEventListener('change', function() {
              const file = this.files[0];
              if (file) {
                  const reader = new FileReader();
                  reader.onload = function(e) {
                      const uploadedPictureURL = e.target.result;
                      profilePic.src = uploadedPictureURL;
                      profileIconImg.src = uploadedPictureURL; // Update profile icon directly with uploaded picture

                      // Store the uploaded picture URL in localStorage
                      localStorage.setItem('uploadedProfilePicture', uploadedPictureURL);
                      console.log("Uploaded picture URL stored in localStorage:", uploadedPictureURL);

                      // Delay showing the alert message for 1 second
                      setTimeout(function() {
                          alert("Profile picture uploaded successfully!"); // Show alert message
                      }, 1000);
                  };
                  reader.readAsDataURL(file);
              }
          });
      });

      //Reset the profile pic
      function logout() {
          // Clear the uploaded profile picture URL from localStorage
          localStorage.removeItem('uploadedProfilePicture');
      }

      document.addEventListener("DOMContentLoaded", function() {
          const profileIconImg = document.getElementById('profileIconImg');
          
          // Check if there's an uploaded profile picture stored in localStorage
          const uploadedPicture = localStorage.getItem('uploadedProfilePicture');
          if (uploadedPicture) {
              profileIconImg.src = uploadedPicture; // Update profile icon with uploaded picture
          } else {
              // If no profile picture is found in localStorage, set the default profile picture
              profileIconImg.src = './images/ic_profile.png'; 
          }
      });
  </script>
</body>
</html>
